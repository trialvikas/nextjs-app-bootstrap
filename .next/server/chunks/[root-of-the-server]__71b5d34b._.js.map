{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///project/sandbox/user-workspace/src/lib/stock.ts"],"sourcesContent":["import yahooFinance from 'yahoo-finance2';\nimport { RSI, BollingerBands, EMA, SMA } from 'technicalindicators';\n\nexport interface StockQuote {\n  symbol: string;\n  regularMarketPrice: number;\n  regularMarketChange: number;\n  regularMarketChangePercent: number;\n  regularMarketDayHigh: number;\n  regularMarketDayLow: number;\n  regularMarketOpen: number;\n  regularMarketPreviousClose: number;\n  regularMarketVolume: number;\n  marketCap: number;\n  shortName: string;\n  longName: string;\n  currency: string;\n  exchangeName: string;\n}\n\nexport interface TechnicalAnalysis {\n  rsi: number;\n  bollingerBands: {\n    upper: number;\n    middle: number;\n    lower: number;\n  };\n  ema20: number;\n  ema90: number;\n  sma20: number;\n  sma90: number;\n  trendAnalysis: {\n    signal: 'BULL_RUN' | 'BEAR_MARKET' | 'SIDEWAYS' | 'NEUTRAL';\n    description: string;\n    strength: 'STRONG' | 'MODERATE' | 'WEAK';\n  };\n}\n\nexport interface HistoricalPrice {\n  date: Date;\n  close: number;\n  high: number;\n  low: number;\n  open: number;\n  volume: number;\n}\n\nexport interface NewsItem {\n  title: string;\n  summary: string;\n  publishedAt: string;\n  url: string;\n  source: string;\n}\n\nexport async function getStockQuote(symbol: string): Promise<StockQuote | null> {\n  try {\n    const quote = await yahooFinance.quote(symbol);\n    \n    if (!quote) {\n      return null;\n    }\n\n    return {\n      symbol: quote.symbol || symbol,\n      regularMarketPrice: quote.regularMarketPrice || 0,\n      regularMarketChange: quote.regularMarketChange || 0,\n      regularMarketChangePercent: quote.regularMarketChangePercent || 0,\n      regularMarketDayHigh: quote.regularMarketDayHigh || 0,\n      regularMarketDayLow: quote.regularMarketDayLow || 0,\n      regularMarketOpen: quote.regularMarketOpen || 0,\n      regularMarketPreviousClose: quote.regularMarketPreviousClose || 0,\n      regularMarketVolume: quote.regularMarketVolume || 0,\n      marketCap: quote.marketCap || 0,\n      shortName: quote.shortName || symbol,\n      longName: quote.longName || quote.shortName || symbol,\n      currency: quote.currency || 'USD',\n      exchangeName: quote.fullExchangeName || quote.exchange || 'Unknown'\n    };\n  } catch (error) {\n    console.error(`Error fetching stock quote for ${symbol}:`, error);\n    return null;\n  }\n}\n\nexport async function getStockNews(symbol: string): Promise<NewsItem[]> {\n  try {\n    const newsData = await yahooFinance.search(symbol, {\n      newsCount: 10\n    });\n\n    if (!newsData.news || newsData.news.length === 0) {\n      return [];\n    }\n\n    return newsData.news.map((item: any) => ({\n      title: item.title || 'No title available',\n      summary: item.summary || item.title || 'No summary available',\n      publishedAt: item.providerPublishTime \n        ? new Date(item.providerPublishTime * 1000).toISOString()\n        : new Date().toISOString(),\n      url: item.link || '#',\n      source: item.publisher || 'Unknown'\n    }));\n  } catch (error) {\n    console.error(`Error fetching news for ${symbol}:`, error);\n    return [];\n  }\n}\n\nexport async function getHistoricalData(symbol: string, period: string = '6mo'): Promise<HistoricalPrice[]> {\n  try {\n    const queryOptions = {\n      period1: new Date(Date.now() - 6 * 30 * 24 * 60 * 60 * 1000), // 6 months ago\n      period2: new Date(),\n      interval: '1d' as const\n    };\n\n    const result = await yahooFinance.historical(symbol, queryOptions);\n    \n    return result.map(item => ({\n      date: item.date,\n      close: item.close || 0,\n      high: item.high || 0,\n      low: item.low || 0,\n      open: item.open || 0,\n      volume: item.volume || 0\n    }));\n  } catch (error) {\n    console.error(`Error fetching historical data for ${symbol}:`, error);\n    return [];\n  }\n}\n\nexport function calculateTechnicalAnalysis(historicalData: HistoricalPrice[], currentPrice: number): TechnicalAnalysis | null {\n  if (historicalData.length < 90) {\n    return null; // Need at least 90 days for 90-period moving averages\n  }\n\n  const closePrices = historicalData.map(d => d.close);\n  const highPrices = historicalData.map(d => d.high);\n  const lowPrices = historicalData.map(d => d.low);\n\n  try {\n    // Calculate RSI (14-period)\n    const rsiValues = RSI.calculate({ values: closePrices, period: 14 });\n    const currentRSI = rsiValues[rsiValues.length - 1] || 50;\n\n    // Calculate Bollinger Bands (20-period, 2 standard deviations)\n    const bbValues = BollingerBands.calculate({\n      values: closePrices,\n      period: 20,\n      stdDev: 2\n    });\n    const currentBB = bbValues[bbValues.length - 1] || { upper: 0, middle: 0, lower: 0 };\n\n    // Calculate EMAs\n    const ema20Values = EMA.calculate({ values: closePrices, period: 20 });\n    const ema90Values = EMA.calculate({ values: closePrices, period: 90 });\n    const currentEMA20 = ema20Values[ema20Values.length - 1] || 0;\n    const currentEMA90 = ema90Values[ema90Values.length - 1] || 0;\n\n    // Calculate SMAs for additional reference\n    const sma20Values = SMA.calculate({ values: closePrices, period: 20 });\n    const sma90Values = SMA.calculate({ values: closePrices, period: 90 });\n    const currentSMA20 = sma20Values[sma20Values.length - 1] || 0;\n    const currentSMA90 = sma90Values[sma90Values.length - 1] || 0;\n\n    // Trend Analysis Logic\n    const trendAnalysis = analyzeTrend(currentRSI, currentPrice, currentBB, currentEMA20, currentEMA90);\n\n    return {\n      rsi: currentRSI,\n      bollingerBands: {\n        upper: currentBB.upper,\n        middle: currentBB.middle,\n        lower: currentBB.lower\n      },\n      ema20: currentEMA20,\n      ema90: currentEMA90,\n      sma20: currentSMA20,\n      sma90: currentSMA90,\n      trendAnalysis\n    };\n  } catch (error) {\n    console.error('Error calculating technical analysis:', error);\n    return null;\n  }\n}\n\nfunction analyzeTrend(\n  rsi: number,\n  currentPrice: number,\n  bollingerBands: { upper: number; middle: number; lower: number },\n  ema20: number,\n  ema90: number\n) {\n  // Bull Run Conditions: RSI > 60, Price > BB Middle, EMA20 > EMA90\n  const isBullish = rsi > 60 && currentPrice > bollingerBands.middle && ema20 > ema90;\n  \n  // Bear Market Conditions: RSI < 40, Price < BB Middle, EMA20 < EMA90\n  const isBearish = rsi < 40 && currentPrice < bollingerBands.middle && ema20 < ema90;\n  \n  // Strong signals\n  const isStrongBull = rsi > 70 && currentPrice > bollingerBands.upper && ema20 > ema90 * 1.02;\n  const isStrongBear = rsi < 30 && currentPrice < bollingerBands.lower && ema20 < ema90 * 0.98;\n\n  if (isStrongBull) {\n    return {\n      signal: 'BULL_RUN' as const,\n      description: 'Strong bullish momentum detected. RSI is overbought, price is above upper Bollinger Band, and short-term EMA is significantly above long-term EMA.',\n      strength: 'STRONG' as const\n    };\n  } else if (isBullish) {\n    return {\n      signal: 'BULL_RUN' as const,\n      description: 'Bullish trend confirmed. RSI above 60, price above Bollinger Band middle line, and 20 EMA above 90 EMA.',\n      strength: 'MODERATE' as const\n    };\n  } else if (isStrongBear) {\n    return {\n      signal: 'BEAR_MARKET' as const,\n      description: 'Strong bearish momentum detected. RSI is oversold, price is below lower Bollinger Band, and short-term EMA is significantly below long-term EMA.',\n      strength: 'STRONG' as const\n    };\n  } else if (isBearish) {\n    return {\n      signal: 'BEAR_MARKET' as const,\n      description: 'Bearish trend confirmed. RSI below 40, price below Bollinger Band middle line, and 20 EMA below 90 EMA.',\n      strength: 'MODERATE' as const\n    };\n  } else if (rsi >= 45 && rsi <= 55 && Math.abs(ema20 - ema90) / ema90 < 0.02) {\n    return {\n      signal: 'SIDEWAYS' as const,\n      description: 'Market is moving sideways. RSI is neutral, and moving averages are converging.',\n      strength: 'WEAK' as const\n    };\n  } else {\n    return {\n      signal: 'NEUTRAL' as const,\n      description: 'Mixed signals detected. Market direction is unclear based on current technical indicators.',\n      strength: 'WEAK' as const\n    };\n  }\n}\n\nexport async function getStockData(symbol: string) {\n  try {\n    const [quote, news, historicalData] = await Promise.all([\n      getStockQuote(symbol),\n      getStockNews(symbol),\n      getHistoricalData(symbol)\n    ]);\n\n    let technicalAnalysis: TechnicalAnalysis | null = null;\n    if (quote && historicalData.length > 0) {\n      technicalAnalysis = calculateTechnicalAnalysis(historicalData, quote.regularMarketPrice);\n    }\n\n    return {\n      quote,\n      news,\n      technicalAnalysis,\n      success: true\n    };\n  } catch (error) {\n    console.error(`Error fetching stock data for ${symbol}:`, error);\n    return {\n      quote: null,\n      news: [],\n      technicalAnalysis: null,\n      success: false,\n      error: 'Failed to fetch stock data'\n    };\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 306, "column": 0}, "map": {"version":3,"sources":["file:///project/sandbox/user-workspace/src/app/api/stock/%5Bsymbol%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { getStockData } from '@/lib/stock';\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ symbol: string }> }\n) {\n  try {\n    const { symbol: rawSymbol } = await params;\n    const symbol = rawSymbol?.toUpperCase();\n    \n    if (!symbol) {\n      return NextResponse.json(\n        { error: 'Stock symbol is required' },\n        { status: 400 }\n      );\n    }\n\n    // Validate symbol format (basic validation)\n    if (!/^[A-Z]{1,5}$/.test(symbol)) {\n      return NextResponse.json(\n        { error: 'Invalid stock symbol format' },\n        { status: 400 }\n      );\n    }\n\n    const stockData = await getStockData(symbol);\n\n    if (!stockData.success) {\n      return NextResponse.json(\n        { error: stockData.error || 'Failed to fetch stock data' },\n        { status: 500 }\n      );\n    }\n\n    if (!stockData.quote) {\n      return NextResponse.json(\n        { error: 'Stock not found' },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        quote: stockData.quote,\n        news: stockData.news,\n        technicalAnalysis: stockData.technicalAnalysis\n      }\n    });\n\n  } catch (error) {\n    console.error('API Error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAA2C;IAEnD,IAAI;QACF,MAAM,EAAE,QAAQ,SAAS,EAAE,GAAG,MAAM;QACpC,MAAM,SAAS,WAAW;QAE1B,IAAI,CAAC,QAAQ;YACX,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA2B,GACpC;gBAAE,QAAQ;YAAI;QAElB;QAEA,4CAA4C;QAC5C,IAAI,CAAC,eAAe,IAAI,CAAC,SAAS;YAChC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA8B,GACvC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,YAAY,MAAM,CAAA,GAAA,qHAAA,CAAA,eAAY,AAAD,EAAE;QAErC,IAAI,CAAC,UAAU,OAAO,EAAE;YACtB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,UAAU,KAAK,IAAI;YAA6B,GACzD;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,CAAC,UAAU,KAAK,EAAE;YACpB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAkB,GAC3B;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;gBACJ,OAAO,UAAU,KAAK;gBACtB,MAAM,UAAU,IAAI;gBACpB,mBAAmB,UAAU,iBAAiB;YAChD;QACF;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}